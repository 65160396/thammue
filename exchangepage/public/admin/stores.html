<!DOCTYPE html><html lang="th"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>อนุมัติเปิดร้าน | Admin</title>
<style>.wrap{width:min(1080px,100%);margin:18px auto;padding:0 16px}.row{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;background:#fff;border-radius:12px;padding:10px;margin-bottom:8px;box-shadow:0 4px 18px rgba(0,0,0,.06)}button{padding:6px 10px;border-radius:8px;border:0}</style>
</head><body>
<div class="wrap">
  <h2>คำขอเปิดร้าน (pending)</h2>
  <label>โมดูล:
    <select id="proj">
      <option value="shop">shop (ซื้อขาย)</option>
      <option value="exchange">exchange (แลกเปลี่ยน)</option>
    </select>
  </label>
  <div id="list"></div>
</div>
<script src="admin.js"></script>
<script>
(async()=>{
  await admin.ensureLogin();
  proj.value = admin.project; proj.onchange = ()=>{ admin.project = proj.value; location.reload(); };
  const {rows} = await admin.api('/thammue/admin/stores/list.php?status=pending');
  const box = document.getElementById('list');
  rows.forEach(r=>{
    const el=document.createElement('div'); el.className='row';
    el.innerHTML = `<div><b>${r.name}</b><br><small>user_id=${r.user_id}</small><br>${r.description||''}</div>
      <button data-act="approve" data-id="${r.id}">อนุมัติ</button>
      <button data-act="reject" data-id="${r.id}">ปฏิเสธ</button>`;
    box.appendChild(el);
  });
  box.addEventListener('click', async(e)=>{
    const b=e.target.closest('button'); if(!b) return;
    const url = b.dataset.act==='approve'?'/thammue/admin/stores/approve.php':'/thammue/admin/stores/reject.php';
    const ok = await admin.api(url,{id:+b.dataset.id},'POST',true);
    if(ok.ok){ b.closest('.row').remove(); }
  });
})();
</script>
</body></html>
