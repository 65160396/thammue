<!DOCTYPE html><html lang="th"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>KYC | Admin</title>
<style>.wrap{width:min(1080px,100%);margin:18px auto;padding:0 16px}.card{background:#fff;border-radius:12px;padding:12px;box-shadow:0 4px 18px rgba(0,0,0,.06);margin-bottom:10px}.btn{padding:6px 10px;border-radius:8px;border:0;margin-right:6px}</style>
</head><body>
<div class="wrap">
  <h2>KYC pending</h2>
  <label>โมดูล:
    <select id="proj">
      <option value="exchange">exchange (แลกเปลี่ยน)</option>
      <option value="shop">shop (ซื้อขาย)</option>
    </select>
  </label>
  <div id="list"></div>
</div>
<script src="admin.js"></script>
<script>
(async()=>{
  await admin.ensureLogin();
  proj.value = admin.project; proj.onchange = ()=>{ admin.project = proj.value; location.reload(); };
  const {rows} = await admin.api('/thammue/admin/kyc/list.php?status=pending');
  const box = document.getElementById('list');
  rows.forEach(k=>{
    const el=document.createElement('div'); el.className='card';
    const link = n => n?`<a target="_blank" href="/thammue/admin/kyc/file.php?name=${encodeURIComponent(n)}">เปิด</a>`:'-';
    el.innerHTML = `<b>${k.full_name}</b> (${k.id_type})<br>เลข: ${k.id_number}<br>
      หน้าบัตร: ${link(k.file_path_front)} | หลังบัตร: ${link(k.file_path_back)} | เซลฟี: ${link(k.selfie_path)}
      <br><textarea rows="2" style="width:100%;margin:8px 0" placeholder="โน้ต (ถ้ามี)"></textarea>
      <button class="btn" data-act="approve" data-id="${k.id}">อนุมัติ</button>
      <button class="btn" data-act="reject" data-id="${k.id}">ปฏิเสธ</button>`;
    box.appendChild(el);
  });
  box.addEventListener('click', async(e)=>{
    const b=e.target.closest('button'); if(!b) return;
    const note=b.parentElement.querySelector('textarea').value.trim();
    const ok = await admin.api('/thammue/admin/kyc/decide.php',{id:+b.dataset.id,action:b.dataset.act,note},'POST',true);
    if(ok.ok){ b.parentElement.remove(); }
  });
})();
</script>
</body></html>
