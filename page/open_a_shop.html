<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Thammue – เปิดร้านค้า</title>
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/open-shop.css" />
    </head>

    <body class="open-shop">
        <!-- แถบบนสุด -->
        <ul class="top-nav">
            <li><a href="/exchangepage/index.html">แลกเปลี่ยนสินค้า</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="open_a_shop.html">เปิดร้านค้า</a></li>
            <li class="right"><a href="#notification">แจ้งเตือน</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#help">ช่วยเหลือ</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#lang">ไทย</a></li>
        </ul>

        <div class="header-wrapper">
            <div class="logo-container">
                <a href="/page/main.html" class="brand-text">THAMMUE</a>
            </div>
        </div>

        <main class="wizard-page">
            <section class="wizard-card">

                <!-- Stepper -->
                <nav class="stepper" aria-label="ขั้นตอนการเปิดร้าน">
                    <div class="step is-active" data-step="1">
                        <span class="dot"></span>
                        <span class="label">ข้อมูลสินค้า</span>
                    </div>
                    <div class="step" data-step="2">
                        <span class="dot"></span>
                        <span class="label">ยืนยันตัวตน</span>
                    </div>
                    <div class="step" data-step="3">
                        <span class="dot"></span>
                        <span class="label">ข้อมูลเพิ่มเติม</span>
                    </div>
                    <div class="step" data-step="4">
                        <span class="dot"></span>
                        <span class="label">ส่งแบบฟอร์ม</span>
                    </div>
                </nav>

                <!-- ฟอร์มเปิดร้าน -->
                <form id="openShopForm"
                    action="/page/backend/shop_create.php"
                    method="post"
                    enctype="multipart/form-data"
                    autocomplete="off">

                    <!-- STEP 1 -->
                    <section id="step1" class="panel">
                        <div class="field">
                            <label for="shop_name">ชื่อร้านค้า</label>
                            <input id="shop_name" name="shop_name" required />
                        </div>
                        <div class="field">
                            <label
                                for="pickup_addr">ที่อยู่ในการเข้ารับสินค้า</label>
                            <textarea id="pickup_addr" name="pickup_addr"
                                required></textarea>
                        </div>
                        <div class="field">
                            <label for="email">อีเมล์</label>
                            <input id="email" type="email" name="email"
                                required>
                        </div>
                        <div class="field">
                            <label for="phone">หมายเลขโทรศัพท์</label>
                            <input id="phone" type="tel" name="phone"
                                required />
                        </div>
                        <div class="actions">
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 2 : ยืนยันตัวตน -->
                    <section id="step2" class="panel" hidden>
                        <header class="panel-head">
                        </header>

                        <div class="field inline">
                            <label>ประเภทผู้ขาย *</label>
                            <div class="radio-row">
                                <label><input type="radio" name="sellerType"
                                        value="person" required>
                                    บุคคลธรรมดา</label>
                                <label><input type="radio" name="sellerType"
                                        value="company"> นิติบุคคล</label>
                            </div>
                            <div class="hint" id="typeHint"
                                hidden>กรุณาเลือกประเภทผู้ขาย</div>
                        </div>

                        <!-- บุคคลธรรมดา -->
                        <div id="personFields" class="type-group" hidden>
                            <div class="field">
                                <label for="citizenName">ชื่อ-นามสกุล *</label>
                                <input id="citizenName" name="citizenName"
                                    disabled required>
                            </div>
                            <div class="field">
                                <label for="citizenId">เลขบัตรประชาชน (13 หลัก)
                                    *</label>
                                <input id="citizenId" name="citizenId"
                                    inputmode="numeric" maxlength="13"
                                    pattern="\d{13}" disabled required>
                            </div>

                            <div class="grid2">
                                <div class="field">
                                    <label for="idFront">บัตรประชาชนด้านหน้า
                                        (JPG/PNG/PDF ≤ 5MB) *</label>
                                    <input type="file" id="idFront"
                                        name="idFront"
                                        accept="image/*,application/pdf"
                                        disabled required>
                                </div>
                                <div class="field">
                                    <label for="idBack">บัตรประชาชนด้านหลัง
                                        (JPG/PNG/PDF ≤ 5MB) *</label>
                                    <input type="file" id="idBack" name="idBack"
                                        accept="image/*,application/pdf"
                                        disabled required>
                                </div>
                            </div>
                        </div>

                        <!-- นิติบุคคล -->
                        <div id="companyFields" class="type-group" hidden>
                            <div class="field">
                                <label for="companyName">ชื่อบริษัท *</label>
                                <input id="companyName" name="companyName"
                                    disabled required>
                            </div>
                            <div class="field">
                                <label for="taxId">เลขประจำตัวผู้เสียภาษี (10–13
                                    หลัก) *</label>
                                <input id="taxId" name="taxId"
                                    inputmode="numeric" maxlength="13"
                                    pattern="\d{10,13}" disabled required>
                            </div>

                            <div class="grid2">
                                <div class="field">
                                    <label for="regDoc">หนังสือรับรองนิติบุคคล
                                        (PDF/JPG/PNG ≤ 5MB) *</label>
                                    <input type="file" id="regDoc" name="regDoc"
                                        accept="application/pdf,image/*"
                                        disabled required>
                                </div>
                                <div class="field">
                                    <label
                                        for="idRep">บัตรประชาชนผู้มีอำนาจลงนาม
                                        (PDF/JPG/PNG ≤ 5MB) *</label>
                                    <input type="file" id="idRep" name="idRep"
                                        accept="application/pdf,image/*"
                                        disabled required>
                                </div>
                            </div>
                        </div>

                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 3 -->
                    <section id="step3" class="panel" hidden>
                        <!-- … โค้ดเดิม … -->
                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 4 -->
                    <section id="step4" class="panel" hidden>
                        <div style="max-width:560px;margin:0 auto">
                            <p><strong>ตรวจสอบข้อมูลให้ครบถ้วน</strong> แล้วกด
                                “ส่งแบบฟอร์ม”</p>
                        </div>
                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="submit"
                                class="btn">ส่งแบบฟอร์ม</button>
                        </div>
                    </section>
                </form>

            </section>
        </main>

        <script>
  const total = 4;
  let current = 1;
  const steps  = [...document.querySelectorAll('.step')];
  const panels = [
    document.getElementById('step1'),
    document.getElementById('step2'),
    document.getElementById('step3'),
    document.getElementById('step4')
  ];

  function goto(n){
    current = Math.max(1, Math.min(total, n));
    panels.forEach((p,i)=> p.hidden = (i !== current-1));
    steps.forEach((s,i)=>{
      s.classList.toggle('is-active', i === current-1);
      s.classList.toggle('is-done',   i <  current-1);
    });
  }

  document.querySelectorAll('[data-next]').forEach(b=>b.addEventListener('click', ()=>{
    if (validateStep(current)) goto(current+1);
  }));
  document.querySelectorAll('[data-prev]').forEach(b=>b.addEventListener('click', ()=> goto(current-1)));

  function validateStep(idx){
    if (idx === 1){
      const s1 = panels[0];
      return [...s1.querySelectorAll('input[required],textarea[required]')]
        .every(el => el.value.trim() !== '');
    }
    if (idx === 2){
      const ok = !!panels[1].querySelector('input[name="sellerType"]:checked');
      document.getElementById('typeHint').hidden = ok;
      return ok;
    }
    return true;
  }

  goto(1);
</script>

        <script>
/* Prefill email from ?email= หรือ PHP session (me.php) โดยไม่ล็อกช่อง/ไม่โชว์ hint */
(function(){
  const emailInput = document.getElementById('shopEmail');
  if (!emailInput) return;

  // ตั้งค่าเฉพาะถ้ายังไม่มีใครพิมพ์ไว้
  const setEmailIfEmpty = (v) => {
    if (!v) return;
    if (!emailInput.value) emailInput.value = v;
  };

  // 1) จาก query string (เช่น ...?email=foo@bar.com)
  const sp = new URLSearchParams(location.search);
  setEmailIfEmpty(sp.get('email'));

  // 2) จาก PHP session (ถ้าล็อกอินอยู่)
  fetch('/page/backend/me.php', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : { ok:false })
    .then(d => { if (d && d.ok) setEmailIfEmpty(d.user?.email || ''); })
    .catch(() => {});
})();
</script>

        <script>
(function(){
  const emailInput = document.getElementById('email');
  if (!emailInput) return;
  const setIfEmpty = v => { if (v && !emailInput.value) emailInput.value = v; };

  const sp = new URLSearchParams(location.search);
  setIfEmpty(sp.get('email'));

  fetch('/page/backend/me.php', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : { ok:false })
    .then(d => { if (d && d.ok) setIfEmpty(d.user?.email || ''); })
    .catch(()=>{});
})();
</script>

        <script>
/* ===== Step 2: toggle group + validate ===== */
const personGroup  = document.getElementById('personFields');
const companyGroup = document.getElementById('companyFields');
const typeHint     = document.getElementById('typeHint');

function toggleGroup(group, enable){
  group.hidden = !enable;
  group.querySelectorAll('input,textarea,select').forEach(el=>{
    el.disabled  = !enable;
    el.required  = enable;   // บังคับกรอกเฉพาะกลุ่มที่เลือก
  });
}

function onTypeChange(){
  const val = document.querySelector('input[name="sellerType"]:checked')?.value;
  if (val === 'person') {
    toggleGroup(personGroup,  true);
    toggleGroup(companyGroup, false);
  } else if (val === 'company') {
    toggleGroup(personGroup,  false);
    toggleGroup(companyGroup, true);
  }
}
document.querySelectorAll('input[name="sellerType"]').forEach(r=>{
  r.addEventListener('change', onTypeChange);
});
onTypeChange();

/* ขยาย validateStep สำหรับสเตป 2 */
const MAX_FILE = 5 * 1024 * 1024;
function fileOK(input){
  const f = input.files?.[0];
  if (!f) return false;
  if (f.size > MAX_FILE) { alert('ไฟล์เกิน 5MB'); return false; }
  const ok = ['image/jpeg','image/png','application/pdf'];
  if (!ok.includes(f.type)) { alert('ชนิดไฟล์ต้องเป็น JPG/PNG/PDF'); return false; }
  return true;
}

const oldValidate = validateStep; // ของคุณเดิม
validateStep = function(idx){
  if (idx === 2){
    const val = document.querySelector('input[name="sellerType"]:checked')?.value;
    const okType = !!val;
    typeHint.hidden = okType;
    if (!okType) return false;

    if (val === 'person') {
      const name = document.getElementById('citizenName').value.trim();
      const cid  = document.getElementById('citizenId').value.trim();
      const f1   = document.getElementById('idFront');
      const f2   = document.getElementById('idBack');
      if (!name) { alert('กรอกชื่อ-นามสกุล'); return false; }
      if (!/^\d{13}$/.test(cid)) { alert('เลขบัตรประชาชน 13 หลัก'); return false; }
      if (!fileOK(f1) || !fileOK(f2)) return false;
      return true;
    } else {
      const cname = document.getElementById('companyName').value.trim();
      const taxid = document.getElementById('taxId').value.trim();
      const d1    = document.getElementById('regDoc');
      const d2    = document.getElementById('idRep');
      if (!cname) { alert('กรอกชื่อบริษัท'); return false; }
      if (!/^\d{10,13}$/.test(taxid)) { alert('เลขผู้เสียภาษี 10–13 หลัก'); return false; }
      if (!fileOK(d1) || !fileOK(d2)) return false;
      return true;
    }
  }
  return oldValidate(idx);
};
</script>

    </body>
</html>
