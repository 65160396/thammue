<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Thammue – เปิดร้านค้า</title>
        <link rel="stylesheet" href="/css/style.css" />
        <link rel="stylesheet" href="/css/open-shop.css" />
    </head>

    <body class="open-shop">
        <!-- แถบบนสุด -->
        <ul class="top-nav">
            <li><a href="/exchangepage/index.html">แลกเปลี่ยนสินค้า</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="open_a_shop.html">เปิดร้านค้า</a></li>
            <li class="right"><a href="#notification">แจ้งเตือน</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#help">ช่วยเหลือ</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#lang">ไทย</a></li>
        </ul>

        <div class="header-wrapper">
            <div class="logo-container">
                <a href="/page/main.html" class="brand-text">THAMMUE</a>
            </div>
        </div>

        <main class="wizard-page">
            <section class="wizard-card">

                <!-- Stepper -->
                <nav class="stepper" aria-label="ขั้นตอนการเปิดร้าน">
                    <div class="step is-active" data-step="1">
                        <span class="dot"></span>
                        <span class="label">ข้อมูลสินค้า</span>
                    </div>
                    <div class="step" data-step="2">
                        <span class="dot"></span>
                        <span class="label">ยืนยันตัวตน</span>
                    </div>
                    <div class="step" data-step="3">
                        <span class="dot"></span>
                        <span class="label">ข้อมูลเพิ่มเติม</span>
                    </div>
                    <div class="step" data-step="4">
                        <span class="dot"></span>
                        <span class="label">ส่งแบบฟอร์ม</span>
                    </div>
                </nav>

                <!-- เดิมมีหลาย <form> เปลี่ยนเป็นฟอร์มเดียวที่ครอบทุกสเตป -->
                <form id="openShopForm"
                    action="/page/backend/shop_create.php"
                    method="post"
                    enctype="multipart/form-data"
                    autocomplete="off">

                    <!-- STEP 1 -->
                    <section id="step1" class="panel">
                        <div class="field">
                            <label for="shop_name">ชื่อร้านค้า</label>
                            <input id="shop_name" name="shop_name" required />
                        </div>
                        <div class="field">
                            <label
                                for="pickup_addr">ที่อยู่ในการเข้ารับสินค้า</label>
                            <textarea id="pickup_addr" name="pickup_addr"
                                required></textarea>
                        </div>
                        <div class="field">
                            <label for="email">อีเมล์</label>
                            <input id="email" type="email" name="email"
                                required>
                        </div>
                        <div class="field">
                            <label for="phone">หมายเลขโทรศัพท์</label>
                            <input id="phone" type="tel" name="phone"
                                required />
                        </div>
                        <div class="actions">
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 2 : ยืนยันตัวตน -->
                    <section id="step2" class="panel" hidden>
                        <!-- … โค้ดเดิม … -->
                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 3 -->
                    <section id="step3" class="panel" hidden>
                        <!-- … โค้ดเดิม … -->
                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="button" class="btn"
                                data-next>ถัดไป</button>
                        </div>
                    </section>

                    <!-- STEP 4 -->
                    <section id="step4" class="panel" hidden>
                        <div style="max-width:560px;margin:0 auto">
                            <p><strong>ตรวจสอบข้อมูลให้ครบถ้วน</strong> แล้วกด
                                “ส่งแบบฟอร์ม”</p>
                        </div>
                        <div class="actions">
                            <button type="button" class="btn ghost"
                                data-prev>ย้อนกลับ</button>
                            <button type="submit"
                                class="btn">ส่งแบบฟอร์ม</button>
                        </div>
                    </section>
                </form>

            </section>
        </main>

        <script>
  const total = 4;
  let current = 1;
  const steps  = [...document.querySelectorAll('.step')];
  const panels = [
    document.getElementById('step1'),
    document.getElementById('step2'),
    document.getElementById('step3'),
    document.getElementById('step4')
  ];

  function goto(n){
    current = Math.max(1, Math.min(total, n));
    panels.forEach((p,i)=> p.hidden = (i !== current-1));
    steps.forEach((s,i)=>{
      s.classList.toggle('is-active', i === current-1);
      s.classList.toggle('is-done',   i <  current-1);
    });
  }

  document.querySelectorAll('[data-next]').forEach(b=>b.addEventListener('click', ()=>{
    if (validateStep(current)) goto(current+1);
  }));
  document.querySelectorAll('[data-prev]').forEach(b=>b.addEventListener('click', ()=> goto(current-1)));

  function validateStep(idx){
    if (idx === 1){
      const s1 = panels[0];
      return [...s1.querySelectorAll('input[required],textarea[required]')]
        .every(el => el.value.trim() !== '');
    }
    if (idx === 2){
      const ok = !!panels[1].querySelector('input[name="sellerType"]:checked');
      document.getElementById('typeHint').hidden = ok;
      return ok;
    }
    return true;
  }

  goto(1);
</script>

        <script>
/* Prefill email from ?email= หรือ PHP session (me.php) โดยไม่ล็อกช่อง/ไม่โชว์ hint */
(function(){
  const emailInput = document.getElementById('shopEmail');
  if (!emailInput) return;

  // ตั้งค่าเฉพาะถ้ายังไม่มีใครพิมพ์ไว้
  const setEmailIfEmpty = (v) => {
    if (!v) return;
    if (!emailInput.value) emailInput.value = v;
  };

  // 1) จาก query string (เช่น ...?email=foo@bar.com)
  const sp = new URLSearchParams(location.search);
  setEmailIfEmpty(sp.get('email'));

  // 2) จาก PHP session (ถ้าล็อกอินอยู่)
  fetch('/page/backend/me.php', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : { ok:false })
    .then(d => { if (d && d.ok) setEmailIfEmpty(d.user?.email || ''); })
    .catch(() => {});
})();
</script>

        <script>
(function(){
  const emailInput = document.getElementById('email');
  if (!emailInput) return;
  const setIfEmpty = v => { if (v && !emailInput.value) emailInput.value = v; };

  const sp = new URLSearchParams(location.search);
  setIfEmpty(sp.get('email'));

  fetch('/page/backend/me.php', { cache: 'no-store' })
    .then(r => r.ok ? r.json() : { ok:false })
    .then(d => { if (d && d.ok) setIfEmpty(d.user?.email || ''); })
    .catch(()=>{});
})();
</script>

    </body>
</html>
