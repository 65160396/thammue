<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Thammue</title>
        <link rel="stylesheet" href="/css/style.css" />
        <style>
      /* flash fade in/out */
      #flash{opacity:0;transform:translateY(-4px);transition:opacity .35s ease,transform .35s ease}
      #flash.show{opacity:1;transform:translateY(0)}
      #flash.hide{opacity:0;transform:translateY(-4px)}

      /* ชื่อผู้ใช้ถัดจากไอคอน */
      .icon-buttons .user-area{
        display:flex;align-items:center;gap:8px;color:#fff;text-decoration:none
      }
      .icon-buttons .user-area img{height:26px;width:auto;display:block}
      .icon-buttons .user-chip{
        color:#fff;font-size:14px;opacity:.9;max-width:140px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis
      }
      .icon-buttons .user-area:hover .user-chip{opacity:1}
      @media (max-width:640px){ .icon-buttons .user-chip{display:none} }
      .logout-btn img{height:22px;width:auto;filter:invert(100%)}
    </style>
    </head>

    <body>
        <!-- แถบบนสุด -->
        <ul class="top-nav">
            <!-- ซ้าย -->
            <li><a href="../page/Exchang/index.html">แลกเปลี่ยนสินค้า</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="open_a_shop.html">เปิดร้านค้า</a></li>

            <!-- ขวา -->
            <li class="right"><a href="#notification">แจ้งเตือน</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#help">ช่วยเหลือ</a></li>
            <li><span class="top-divider">|</span></li>
            <li><a href="#lang">ไทย</a></li>
        </ul>

        <!-- Header หลัก -->
        <div class="header-wrapper">
            <div class="logo-container">
                <a href="/page/main.html" class="brand-text">THAMMUE</a>
            </div>

            <div class="search-container">
                <div class="search-group">
                    <input type="text" placeholder="ค้นหาสินค้า" />
                    <button class="search-button" aria-label="ค้นหา">
                        <img src="/img/Icon/search (1).png" alt="ค้นหา" />
                    </button>
                </div>

                <div class="icon-buttons">
                    <button class="action-button"><img src="/img/Icon/heart.png"
                            alt="รายการโปรด" /></button>
                    <button class="action-button"><img
                            src="/img/Icon/shopping-cart.png"
                            alt="ตะกร้า" /></button>
                    <button class="action-button"><img src="/img/Icon/chat.png"
                            alt="แชท" /></button>

                    <!-- โปรไฟล์ + ชื่อผู้ใช้ (เติมชื่อด้วย JS จาก me.php) -->
                    <a href="/page/profile.html" class="user-area"
                        id="userArea">
                        <img src="/img/Icon/user (1).png" alt="โปรไฟล์" />
                        <span class="user-chip" id="userChip" hidden></span>
                    </a>

                    <!-- ปุ่มออกจากระบบแบบไอคอน -->
                    <a href="/page/backend/logout.php"
                        class="action-button logout-btn"
                        aria-label="ออกจากระบบ">
                        <img src="/img/Icon/logout.png" alt="ออกจากระบบ" />
                    </a>
                </div>
            </div>
        </div>

        <div id="flash" class="flash"
            style="display:none;padding:12px;border-radius:8px;margin:12px 0;font-size:14px"></div>

        <div class="category-buttons">
            <a href="/page/category/handmade.html"
                class="category-button">สินค้าแฮนเมด</a>
            <a href="/page/category/jewelry.html"
                class="category-button">เครื่องประดับ</a>
            <a href="/page/category/local_products.html"
                class="category-button">สินค้าท้องถิ่น</a>
            <a href="/page/category/second_hand.html"
                class="category-button">สินค้ามือสอง</a>
        </div>

        <div class="ad-banner">
            <img src="/img/Illustration/โฆษณา.jpg" alt="โฆษณา" />
        </div>

        <!-- แนะนำสำหรับคุณ -->
        <div class="recommended-products">
            <h2>แนะนำสำหรับคุณ</h2>
            <div class="product-grid">
                <!-- ... การ์ดสินค้าเดิมของคุณ ... -->
            </div>
        </div>

        <script>
      (function () {
        var path = location.pathname.replace(/\/+/g,'/').toLowerCase();
        document.querySelectorAll('.category-buttons a.category-button').forEach(function (a) {
          var href = a.getAttribute('href').replace(/\/+/g,'/').toLowerCase();
          if (path.endsWith(href)) a.classList.add('active');
        });
      })();
    </script>

        <!-- Footer (คงเดิม) ... -->

        <script>
      // flash message โชว์ชั่วคราวแล้วจางหาย
      (function(){
        const sp   = new URLSearchParams(location.search);
        const type = sp.get('type'); // success | error
        const msg  = sp.get('msg');
        const SHOW_MS = 2500, FADE_MS = 350;

        if (msg) {
          const box = document.getElementById('flash');
          box.textContent = decodeURIComponent(msg);
          box.style.display = 'block';
          box.style.border = '1px solid ' + (type === 'success' ? '#28a745' : '#dc3545');
          box.style.background = type === 'success' ? '#e8fff0' : '#fff1f1';
          box.style.color = type === 'success' ? '#19692c' : '#7a1f25';

          requestAnimationFrame(() => box.classList.add('show'));
          setTimeout(() => {
            box.classList.add('hide');
            setTimeout(() => { box.style.display='none'; box.classList.remove('show','hide'); }, FADE_MS);
          }, SHOW_MS);

          history.replaceState({}, '', location.pathname);
        }
      })();
    </script>

        <script>
      // เติมชื่อผู้ใช้ข้างไอคอนจาก me.php
      (function () {
        const chip = document.getElementById('userChip');
        const userArea = document.getElementById('userArea');
        if (!chip || !userArea) return;

        fetch('/page/backend/me.php', { cache: 'no-store' })
          .then(r => r.ok ? r.json() : { ok:false })
          .then(d => {
            if (!d || !d.ok) { // ไม่ล็อกอิน
              chip.hidden = true;
              userArea.href = '/page/login.html';
              return;
            }
            const name = (d.user && (d.user.display_name || d.user.name) || '').trim();
            if (name) { chip.textContent = name; chip.hidden = false; }
          })
          .catch(() => { chip.hidden = true; });
      })();
    </script>
    </body>
</html>
