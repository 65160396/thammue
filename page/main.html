<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Thammue</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/instyle.css" />
    <link rel="stylesheet" href="/css/products.css" />
    <link rel="stylesheet" href="/css/search.css">
  </head>

  <body>
    <!-- แถบบนสุด -->
    <ul class="top-nav">
      <!-- ซ้าย -->
      <li><a href="/exchangepage/index.html">แลกเปลี่ยนสินค้า</a></li>
      <li><span class="top-divider">|</span></li>
      <li><a id="openOrMyShop" href="/page/open_a_shop.html">เปิดร้านค้า</a>

        <!-- ขวา -->
        <li class="right"><a href="#notification">แจ้งเตือน</a></li>
        <li><span class="top-divider">|</span></li>
        <li><a href="#help">ช่วยเหลือ</a></li>
        <li><span class="top-divider">|</span></li>
        <li><a href="#lang">ไทย</a></li>
      </ul>

      <!-- Header หลัก -->
      <div class="header-wrapper">
        <div class="logo-container">
          <a href="/page/main.html" class="brand-text">THAMMUE</a>
        </div>

        <button class="hamburger" id="hamburgerBtn" type="button"
          aria-label="เมนู">
          <img src="/img/Icon/menu.png" alt="เมนู">
        </button>

        <!--ค้นหา-->
        <div class="search-container">
          <div class="search-group">
            <input id="q" type="text" placeholder="ค้นหาสินค้า"
              autocomplete="off" autocapitalize="off" spellcheck="false"
              role="combobox" aria-autocomplete="list" aria-expanded="false"
              aria-controls="qSuggest" aria-haspopup="listbox" />

            <button id="btnSearch" class="search-button" type="button"
              aria-label="ค้นหา">
              <img src="/img/Icon/search.png" alt="ค้นหา" />
            </button>

            <!-- เอา hidden ออก -->
            <div id="qSuggest" class="search-suggest"></div>
          </div>

          <div class="icon-buttons desktop-icons">
            <a class="action-button" href="/page/favorites/index.php"
              aria-label="รายการโปรด">
              <img src="/img/Icon/heart.png" alt="รายการโปรด">
              <span id="favBadge" class="icon-badge" hidden>0</span>
            </a>

            <a class="action-button" href="/page/cart/index.php"
              aria-label="ตะกร้า" style="position:relative">
              <img src="/img/Icon/shopping-cart.png" alt="ตะกร้า">
              <span id="cartBadge" class="icon-badge" hidden>0</span>
            </a>

            <button class="action-button"><img src="/img/Icon/chat.png"
                alt="แชท" /></button>

            <!-- ▼ โปรไฟล์ + ชื่อ + เมนูดรอปดาวน์ -->
            <div class="user-menu" id="userMenu">
              <!---กล่องรวมปุ่มโปรไฟล์ + เมนูดรอปดาวน์ -->

              <button class="user-area" id="userArea" aria-haspopup="true"
                aria-expanded="false"> <!---userArea ที่ไว้ เปิด ปิดเมนู-->

                <img src="/img/Icon/user.png" alt="โปรไฟล์" />
                <span class="user-chip" id="userChip" hidden></span>
                <!---userChip ที่ไว้โชว์ชื่อผู้ใช้-->
                <svg class="chev" viewBox="0 0 20 20" aria-hidden="true">
                  <!---ตัวเลขเป็นพิกัดวาดรูปลูกศร ชี้ลง-->
                  <path d="M5.5 7.5l4.5 4 4.5-4" fill="none"
                    stroke="currentColor" stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round" />
                </svg>
              </button>

              <div class="user-dropdown" id="userDropdown"
                role="menu">
                <!-- JS จะเติมรายการให้หลังจาก login/logout -->
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- Flash Popup -->
      <!-- Toast -->
      <div id="flash" class="flash-toast" aria-live="polite"></div>

      <!-- ปุ่มหมวด -->
      <div class="category-buttons">
        <a href="/page/category/handmade.html"
          class="category-button">สินค้าแฮนเมด</a>
        <a href="/page/category/craft.html"
          class="category-button">งานประดิษฐ์</a>
        <a href="/page/category/local_products.html"
          class="category-button">สินค้าท้องถิ่น</a>
        <a href="/page/category/second_hand.html"
          class="category-button">สินค้ามือสอง</a>
      </div>

      <div class="ad-banner">
        <img src="/img/Illustration/โฆษณา.jpg" alt="โฆษณา" />
      </div>
      <!-- ผลการค้นหา -->
      <section id="searchSection" class="search-results" hidden>
        <div class="search-results__head">
          <h2>ผลการค้นหา <span id="searchCount"></span></h2>
          <a href="#" id="clearSearch" class="btn btn-primary">ล้างการค้นหา</a>
        </div>
        <div id="results" class="product-grid"></div>
      </section>

      <!-- แนะนำสำหรับคุณ -->
      <section class="recommended-products">
        <h2>แนะนำสำหรับคุณ</h2>
        <div id="homeGrid" class="product-grid"></div>
      </section>

      <script src="/js/nav-active.js"></script>
      <script src="/js/flashmessage.js"></script>
      <!--แสดง flash message ชั่วคราวจากพารามิเตอร์-->
      <script src="/js/me.js"></script>
      <script src="/js/user-menu.js"></script>
      <script src="/js/store/shop-toggle.js"></script>
      <script src="/js/api/products.js" defer></script>
      <script src="/js/category/category-feed.js" defer></script>

      <script>
  document.addEventListener('DOMContentLoaded', () => {
    toggleOpenOrMyShop();
  });
</script>

      <script src="/js/productsforsale/products-list.js"></script>
      <script>
  document.addEventListener('DOMContentLoaded', () => {
    renderProducts({
      endpoint: '/page/backend/productsforsale/get_products.php' ,
      container: '#homeGrid'
    });
  });
</script>
      <script src="/js/nav/hamburger.js"></script>

      <script src="/js/fav-badge.js" defer></script>
      <script src="/js/cart-badge.js" defer></script>

      <div class="icons-drawer" id="iconsDrawer" hidden>
        <button class="icons-drawer__close" id="iconsClose">ปิด</button>
        <a href="/page/favorites/index.php"><img src="/img/Icon/heart.png" alt>
          รายการโปรด</a>
        <a href="/page/cart/index.php"><img src="/img/Icon/shopping-cart.png"
            alt> ตะกร้า</a>
        <a href="#"><img src="/img/Icon/chat.png" alt> แชท</a>
      </div>
      <div class="icons-backdrop" id="iconsBackdrop" hidden></div>

      <!-- ใส่ท้ายหน้า ก่อนปิด </body> -->
      <script src="/js/search/search.js"></script>

      <script>
  if (!localStorage.getItem('searchHistory')) {
    localStorage.setItem('searchHistory', JSON.stringify(['ทำมือ', 'สร้อยผ้า', 'งานประดิษฐ์']));
  }
</script>

      <script>
  Search.init({
    input:   "#q",
    button:  "#btnSearch",
    results: "#results",
    endpoint: "/page/backend/search_products.php",
    per: 24,
    sort: "relevance",
    minLength: 1,
    debounceMs: 300,

    prefillLastOnLoad: false,   // ✅ เติมคำค้นล่าสุดลงในช่องค้นหาทันทีที่โหลดหน้า
    autoSearchOnLoad:  false,  // ✅ ไม่ต้องยิงค้นหาอัตโนมัติ (แค่ใส่คำไว้ในช่อง)
    rememberLast:      true    // ✅ จำคำค้นทุกครั้งที่กดค้นหา
  });
</script>

      <script>
  // hotfix: บังคับโชว์เวลาโฟกัส เพื่อกันธีมอื่นที่ใช้ [hidden]{display:none!important}
  document.getElementById('q').addEventListener('focus', () => {
    const box = document.getElementById('qSuggest');
    box.classList.add('show');
    box.removeAttribute('hidden');
  });
</script>

    </body>
  </html>
