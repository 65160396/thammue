<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>สินค้าของฉัน | THAMMUE</title>

    <link rel="stylesheet" href="/css/ex.exchange.css" />
    <link rel="stylesheet" href="/css/ex.header.css" />
    <link rel="stylesheet" href="/css/ex.cards.kebab.css">
    <style>
      body{ background:#f6f8fb; }
      .wrap{max-width:1100px;margin:0 auto;padding:16px}
      .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}

      .card{
        background:#fff;border:1px solid #eef1f5;border-radius:14px;
        overflow:hidden;display:flex;flex-direction:column;position:relative;
        transition:box-shadow .2s ease, transform .2s ease, border-color .2s ease;
      }
      .card:hover{ border-color:#e3e8ef; box-shadow:0 8px 22px rgba(15,23,42,.08); transform:translateY(-1px); }

      /* ลิงก์ครอบทั้งการ์ด */
      .card-link{
        display:block; color:inherit; text-decoration:none; height:100%;
      }
      .card-link:focus-visible{ outline:2px solid #111; outline-offset:2px; border-radius:12px; }

      .thumb{width:100%;height:170px;object-fit:cover;display:block;background:#f3f4f6}
      .body{padding:10px 12px}
      .title{font-weight:800;margin:4px 0 6px}
      .muted{color:#64748b;font-size:13px}
      .empty{margin-top:16px;text-align:center;color:#64748b}

      /* กันเส้นใต้/สีน้ำเงินในลิงก์ภายในการ์ด */
      .card-link .title,
      .card-link .muted{ text-decoration:none; }
    </style>
  </head>
  <body>
    <div data-include="/page/partials/ex_header.html"></div>

    <main class="wrap">
      <h2 style="margin:8px 0 12px;font-weight:800">สินค้าของฉัน</h2>
      <div id="grid" class="grid"></div>
      <div id="empty" class="empty" hidden>ยังไม่มีสินค้า ลองอัปโหลดชิ้นแรกดูนะ</div>
    </main>

    <script src="/js/ex.include.js"></script>
    <script src="/js/me.js"></script>
    <script src="/js/ex.cards.kebab.js"></script>
    <script src="/js/ex.header.js"></script>
    <script>
    (async function(){
      const me = (window.Me && typeof Me.get==='function') ? await Me.get() : { ok:false };
      const myId = me?.ok ? (me.user?.id ?? null) : null;

      try{
        const r = await fetch('/page/backend/ex_list_my_items.php', {credentials:'include', cache:'no-store'});
        const d = await r.json();
        if (!d?.ok) throw new Error(d?.error || 'load_fail');

        const grid = document.getElementById('grid');
        const empty = document.getElementById('empty');

        if (!Array.isArray(d.items) || d.items.length === 0) {
          empty.hidden = false;
          return;
        }

        const fr = document.createDocumentFragment();
        d.items.forEach(it => {
          const card = document.createElement('article');
          card.className = 'ex-card-x card';
          card.setAttribute('data-id', it.id);
          if (myId != null) card.setAttribute('data-user', String(myId));

          const href = `/page/ex_item_view.html?id=${encodeURIComponent(it.id)}`;
          card.innerHTML = `
            <a class="card-link" href="${href}" aria-label="ดูรายละเอียดสินค้า">
              <img class="thumb" src="${it.thumbnail_url || ''}" alt="">
              <div class="body">
                <div class="title">${it.title || '-'}</div>
                <div class="muted">${(it.description || '').slice(0, 60) || '&nbsp;'}</div>
              </div>
            </a>
          `;
          fr.appendChild(card);
        });
        grid.appendChild(fr);

        // ติดตั้งเมนูสามจุด
        if (window.ExCardsKebab?.init) ExCardsKebab.init(grid);

      }catch(e){
        const emptyEl = document.getElementById('empty');
        emptyEl.textContent = 'โหลดรายการไม่สำเร็จ';
        emptyEl.hidden = false;
      }
    })();
    </script>
  </body>
</html>
